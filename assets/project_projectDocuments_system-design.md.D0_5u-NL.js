import{_ as i,c as a,o as n,ag as t,j as l}from"./chunks/framework.BBlOp56t.js";const E=JSON.parse('{"title":"系统设计说明书","description":"","frontmatter":{"title":"系统设计说明书","editLink":true},"headers":[],"relativePath":"project/projectDocuments/system-design.md","filePath":"project/projectDocuments/system-design.md","lastUpdated":null}'),e={name:"project/projectDocuments/system-design.md"};function d(h,s,r,p,o,k){return n(),a("div",null,[...s[0]||(s[0]=[t('<h1 id="系统设计说明书" tabindex="-1">系统设计说明书 <a class="header-anchor" href="#系统设计说明书" aria-label="Permalink to &quot;系统设计说明书&quot;">​</a></h1><h2 id="系统架构设计" tabindex="-1">系统架构设计 <a class="header-anchor" href="#系统架构设计" aria-label="Permalink to &quot;系统架构设计&quot;">​</a></h2><h3 id="整体架构图" tabindex="-1">整体架构图 <a class="header-anchor" href="#整体架构图" aria-label="Permalink to &quot;整体架构图&quot;">​</a></h3><p>本系统采用<strong>分层架构</strong>和<strong>模块化设计</strong>，核心分为四层：</p><ol><li><p><strong>前端层（Uni-app / Vue3）</strong></p><ul><li>多端适配（App / H5 / 小程序）</li><li>消息展示与交互、文件下载</li><li>实时通信通过 WebSocket</li></ul></li><li><p><strong>后端层（Spring Boot）</strong></p><ul><li>用户认证、权限管理（JWT）</li><li>REST API 接口、WebSocket 实时通信</li><li>调用 Python 服务完成 AI 处理与数据分析</li><li>定时任务管理与日志审计</li></ul></li><li><p><strong>Python 服务层（FastAPI）</strong></p><ul><li>AI 模块：关键信息提取、摘要生成</li><li>NLP / STT 模块：语义分析、语音转文本</li><li>Markdown / PDF 文件生成</li><li>定时任务调度（APScheduler）</li></ul></li><li><p><strong>数据层</strong></p><ul><li>MySQL：结构化数据（用户、任务、群组）</li><li>MongoDB：原始消息及日志存储</li><li>Redis：缓存与消息队列支持</li></ul></li></ol><h3 id="技术选型" tabindex="-1">技术选型 <a class="header-anchor" href="#技术选型" aria-label="Permalink to &quot;技术选型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>层级</th><th>软件 / 依赖</th><th>说明</th><th>作用</th></tr></thead><tbody><tr><td>后端</td><td>Spring Boot</td><td>Java Web 框架</td><td>提供 REST API、WebSocket、定时任务</td></tr><tr><td>后端</td><td>MyBatis + MySQL</td><td>ORM + 关系型数据库</td><td>存储用户、任务、群组数据</td></tr><tr><td>后端</td><td>Redis</td><td>内存数据库</td><td>消息队列、缓存加速</td></tr><tr><td>前端/后端</td><td>JWT</td><td>JSON Web Token</td><td>用户认证、权限验证</td></tr><tr><td>后端</td><td>Swagger</td><td>API 文档生成</td><td>方便接口测试与文档维护</td></tr><tr><td>前端</td><td>Uni-app</td><td>跨端框架</td><td>App/H5/小程序多端适配</td></tr><tr><td>前端</td><td>Vue3 + Pinia</td><td>前端 MVVM + 状态管理</td><td>页面渲染、状态管理</td></tr><tr><td>前端</td><td>uView UI</td><td>UI 组件库</td><td>快速构建移动端界面</td></tr><tr><td>前端/后端</td><td>WebSocket</td><td>实时通信</td><td>消息实时推送</td></tr></tbody></table><h3 id="项目模块职责说明" tabindex="-1">项目模块职责说明 <a class="header-anchor" href="#项目模块职责说明" aria-label="Permalink to &quot;项目模块职责说明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>模块</th><th>主要功能</th><th>交互对象</th></tr></thead><tbody><tr><td>用户模块</td><td>注册 / 登录 / 权限验证</td><td>前端、数据库</td></tr><tr><td>文件模块</td><td>文件上传 / 下载 / 删除</td><td>前端、本地存储 / 腾讯云COS</td></tr><tr><td>消息模块</td><td>消息缓存 / 队列 / AI触发</td><td>前端、Python服务、Redis</td></tr><tr><td>AI模块</td><td>NLP/摘要/STT / Markdown生成</td><td>Python服务、数据库</td></tr><tr><td>定时任务模块</td><td>批量消息汇总 / 冷却机制</td><td>后端、Python服务</td></tr></tbody></table><h2 id="数据存储策略设计" tabindex="-1">数据存储策略设计 <a class="header-anchor" href="#数据存储策略设计" aria-label="Permalink to &quot;数据存储策略设计&quot;">​</a></h2><h3 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h3><p>本项目作为一个以<strong>群聊信息智能汇总与任务识别</strong>为核心的系统，其数据结构呈现出明显的多层次与异构特征。系统需同时处理：</p><ul><li><strong>结构化数据</strong>：如用户账户、群组信息、任务计划、AI汇总日志；</li><li><strong>半结构化数据</strong>：如群聊消息、AI中间结果、增强消息（AI轻识别结果）；</li><li><strong>非结构化数据</strong>：如图片、语音、文档、PDF等附件。</li></ul><p>为保证系统的<strong>稳定性、扩展性与高性能</strong>，整体采用 <strong>分层异构存储架构</strong>（Multi-Layered Storage Architecture）， 即通过 <strong>MySQL + MongoDB + Redis + 阿里云 OSS</strong> 的协同机制实现不同数据类型的高效管理。</p><hr><h3 id="数据存储总体架构" tabindex="-1">数据存储总体架构 <a class="header-anchor" href="#数据存储总体架构" aria-label="Permalink to &quot;数据存储总体架构&quot;">​</a></h3>',16),l("iframe",{src:"https://www.yuque.com/webdaniuzi/gpc7nz/ypr6p5ikp5s6my6u?singleDoc# 《结构层数据》",width:"100%",height:"600",frameborder:"0",loading:"lazy"},null,-1),t(`<hr><h3 id="各数据库职责与设计" tabindex="-1">各数据库职责与设计 <a class="header-anchor" href="#各数据库职责与设计" aria-label="Permalink to &quot;各数据库职责与设计&quot;">​</a></h3><h4 id="mysql-——-核心业务与元数据层" tabindex="-1">MySQL —— 核心业务与元数据层 <a class="header-anchor" href="#mysql-——-核心业务与元数据层" aria-label="Permalink to &quot;MySQL —— 核心业务与元数据层&quot;">​</a></h4><p><strong>职责定位：</strong> 负责系统中<strong>关系明确、依赖事务一致性</strong>的核心数据，如用户信息、任务管理、AI生成文档索引等。</p><p><strong>存储内容</strong></p><table tabindex="0"><thead><tr><th>表名</th><th>功能说明</th></tr></thead><tbody><tr><td><code>user</code></td><td>用户基本信息（用户名、密码、头像URL、注册时间）</td></tr><tr><td><code>group_info</code></td><td>群聊信息表（群名、群ID、成员数量、关联AI策略）</td></tr><tr><td><code>task</code></td><td>任务表（任务标题、截止时间、来源消息ID、完成状态）</td></tr><tr><td><code>ai_summary_log</code></td><td>AI汇总日志（汇总时间、触发源、Markdown路径）</td></tr><tr><td><code>file_reference</code></td><td>文件索引表（文件URL、文件类型、关联消息或任务ID）</td></tr></tbody></table><p><strong>设计要点</strong></p><ul><li>使用 <strong>InnoDB 引擎</strong>，支持外键与事务；</li><li>统一字符集 <code>utf8mb4</code>；</li><li>所有表包含 <code>created_at</code>、<code>updated_at</code>；</li><li>建立 <code>user_id</code>、<code>group_id</code>、<code>task_id</code> 等联合索引；</li><li>关键日志表采用<strong>冷数据归档策略</strong>，每季度分表。</li></ul><hr><h4 id="mongodb-——-消息与ai中间结果层" tabindex="-1">MongoDB —— 消息与AI中间结果层 <a class="header-anchor" href="#mongodb-——-消息与ai中间结果层" aria-label="Permalink to &quot;MongoDB —— 消息与AI中间结果层&quot;">​</a></h4><p><strong>职责定位：</strong> 用于存储系统中<strong>非结构化或动态结构</strong>的数据，特别是群聊消息、AI初筛结果与增强消息。</p><p><strong>集合设计</strong></p><table tabindex="0"><thead><tr><th>集合名</th><th>功能说明</th></tr></thead><tbody><tr><td><code>raw_messages</code></td><td>存储原始群聊消息（文本、文件、图片等）</td></tr><tr><td><code>linked_messages</code></td><td>文件与文本消息的自动关联结果</td></tr><tr><td><code>ai_light_result</code></td><td>AI轻识别层输出的增强消息（带置信度与AI标签）</td></tr><tr><td><code>ai_summary</code></td><td>AI最终生成的Markdown或JSON结构化总结</td></tr><tr><td><code>user_behavior_log</code></td><td>用户交互日志与AI触发记录</td></tr></tbody></table><hr><p><strong>示例文档结构（AI增强消息）</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;group_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;G12231&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;sender&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;张三&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;今晚18点前提交PPT，这是模板&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;attachments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plan.pptx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://oss.aliyun.com/files/plan.pptx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;uploaded_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-03T18:00:00Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-03T18:30:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ai_enriched&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ai_tags&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;任务&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;截止时间&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;importance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.91</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;linked_message_ids&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;msg_172930&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;file_172932&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">着重强调说明</p><p></p><ul><li>“attachments” 与 “content” 由系统自动关联（用户发送消息与文件其实是两条独立记录，后端通过时间与sender匹配生成此结构）</li><li>“ai_tags” 与 “importance” 同样是由 <strong>AI轻识别层（Python FastAPI模块）</strong> 自动添加</li><li>“linked_message_ids” 用于追溯原始消息与文件在 <code>raw_messages</code> 中的ID。</li></ul></div><hr><h4 id="redis-——-缓存与任务中转层" tabindex="-1">Redis —— 缓存与任务中转层 <a class="header-anchor" href="#redis-——-缓存与任务中转层" aria-label="Permalink to &quot;Redis —— 缓存与任务中转层&quot;">​</a></h4><p><strong>职责定位：</strong> 用于<strong>高频写入、低延迟查询</strong>的中间层，承担消息流缓冲、AI触发调度和系统冷却控制三大任务。</p><table tabindex="0"><thead><tr><th>使用场景</th><th>功能说明</th></tr></thead><tbody><tr><td><strong>MessageQueue</strong></td><td>群聊新消息的暂存队列（批量送AI）</td></tr><tr><td><strong>CooldownMap</strong></td><td>存储AI冷却状态，防止短时间重复触发</td></tr><tr><td><strong>Token缓存</strong></td><td>用户JWT令牌与会话信息缓存</td></tr><tr><td><strong>统计缓存</strong></td><td>每日DAU、消息量、AI调用次数等临时指标</td></tr></tbody></table><p><strong>设计要点</strong></p><ul><li>采用 <strong>List</strong> 结构存储消息队列；</li><li>关键缓存项设置 TTL（如 <code>AI_COOLDOWN:group_12231</code> 30分钟）；</li><li>使用 Pub/Sub 实现消息推送与AI触发同步；</li><li>持久化策略：AOF + 每日快照。</li></ul><hr><h4 id="阿里云-腾讯云-oss-——-文件与文档存储层" tabindex="-1">阿里云/腾讯云 OSS —— 文件与文档存储层 <a class="header-anchor" href="#阿里云-腾讯云-oss-——-文件与文档存储层" aria-label="Permalink to &quot;阿里云/腾讯云 OSS —— 文件与文档存储层&quot;">​</a></h4><p><strong>职责定位：</strong> 负责存储所有<strong>非结构化文件与AI生成文档</strong>，包括群聊附件、AI汇总输出、用户相关联的信息。</p><p><strong>存储内容</strong></p><ul><li>群聊上传文件（Word、Excel、PDF等）</li><li>AI生成文档（Markdown、PDF）</li><li>用户上传头像</li><li>临时中转文件（任务导入、日志快照）</li></ul><p><strong>设计要点</strong></p><ul><li>上传后返回唯一URL</li><li>采用分片上传与断点续传</li><li>设置生命周期规则（如临时文件7天自动清理）</li><li>支持AI直接读取OSS URL生成汇总文档</li></ul><hr><h3 id="数据流转过程" tabindex="-1">数据流转过程 <a class="header-anchor" href="#数据流转过程" aria-label="Permalink to &quot;数据流转过程&quot;">​</a></h3><ol><li><strong>群聊消息接入模块</strong>将每条消息（包括文件事件）推入 Redis 队列</li><li>后端定时任务从 Redis 批量读取并写入 MongoDB 的 <code>raw_messages</code></li><li>系统执行消息关联（将文本与文件事件组合），生成 <code>linked_messages</code></li><li>Python FastAPI 模块执行轻量AI识别 → 输出增强消息（含 <code>ai_tags</code> 与 <code>importance</code>）</li><li>增强消息写入 <code>ai_light_result</code> 集合</li><li>触发条件满足时（阈值、冷却结束），AI执行批量汇总</li><li>汇总结果写入 <code>ai_summary</code> 并生成 Markdown 文档</li><li>文档与文件索引同步写入 MySQL</li><li>所有文件流经阿里/腾讯云OSS并返回URL供Markdown展示或下载</li></ol><hr><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>该数据存储架构通过“<strong>Redis → MongoDB → MySQL + OSS</strong>”的多层级协同，实现了：</p><table tabindex="0"><thead><tr><th>指标</th><th>效果</th></tr></thead><tbody><tr><td><strong>写入性能</strong></td><td>Redis队列分担高并发写入压力</td></tr><tr><td><strong>结构适应性</strong></td><td>MongoDB灵活处理动态JSON结构</td></tr><tr><td><strong>数据一致性</strong></td><td>MySQL保证任务与文档记录事务一致</td></tr><tr><td><strong>文件可靠性</strong></td><td>云存储确保文件高可用与长期存储</td></tr><tr><td><strong>AI可扩展性</strong></td><td>AI可直接消费增强消息，低耦合接入</td></tr></tbody></table><p>最终形成一条清晰、可追踪的数据流闭环，为系统的智能分析与文档生成提供了坚实的底层支持。</p><h2 id="ai触发策略设计" tabindex="-1">AI触发策略设计 <a class="header-anchor" href="#ai触发策略设计" aria-label="Permalink to &quot;AI触发策略设计&quot;">​</a></h2><h3 id="背景与问题" tabindex="-1">背景与问题 <a class="header-anchor" href="#背景与问题" aria-label="Permalink to &quot;背景与问题&quot;">​</a></h3><p>在系统运行过程中，群聊消息流量大、内容复杂且多样。在很多情况下，系统并不能在准确的时间点之前提醒用户待办事项。</p><p>例如，当某任务截止时间为中午12:00，而系统汇总时间为下午15:00，该任务信息将无法被及时捕获与提醒。</p><p>这时，我们需要引入AI任务识别机制，做到真正的 <strong>“聪明筛选”</strong>，在每一条消息到来时，让 AI 对其做一个 <strong>“任务置信度评估”</strong></p><p>可若对每条消息都直接调用 AI 模型进行语义理解或摘要处理，这将导致：</p><ul><li>接口调用频率过高，显著增加计算资源与调用APIKey成本；</li><li>无效信息（如闲聊、表情、无关图片）占据处理带宽；</li><li>同类或重复性消息被反复识别，浪费时间与性能。</li></ul><p>因此，本系统在<strong>原始数据采集层</strong>基础上，引入“AI任务识别 + 智能触发策略”机制，在每条消息到达时即进行<strong>轻量级判断与筛选</strong>，再由AI模块进行批量结构化分析，实现<strong>低频调用 + 高置信度触发</strong>的目标。</p><hr><h3 id="消息流总览" tabindex="-1">消息流总览 <a class="header-anchor" href="#消息流总览" aria-label="Permalink to &quot;消息流总览&quot;">​</a></h3><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>群聊消息实时接收 -&gt; 存入 MongoDB（原始层）-&gt; 触发“关联引擎”（将文本与文件事件结合）-&gt; 生成“增强消息”（含 AI tags、linkedFiles、置信度）-&gt; 智能触发模块依据权重判定是否触发 AI 汇总。</span></span></code></pre></div><h3 id="三层筛选逻辑" tabindex="-1">三层筛选逻辑 <a class="header-anchor" href="#三层筛选逻辑" aria-label="Permalink to &quot;三层筛选逻辑&quot;">​</a></h3><p>AI触发策略采用“三层筛选模型”，从浅到深逐步过滤非关键信息：</p><table tabindex="0"><thead><tr><th>层级</th><th>筛选目标</th><th>主要逻辑</th><th>实现方式</th></tr></thead><tbody><tr><td><strong>规则过滤层</strong></td><td>消息有效性</td><td>判断是否包含可解析结构（时间、关键词、文件事件等），并关联文件消息</td><td>正则匹配 / 消息类型检测 + 关联引擎</td></tr><tr><td><strong>语义热词层</strong></td><td>语义相关性</td><td>检测是否包含高相关关键词，如“提交”“截止”“报名”“见附件”等</td><td>TF-IDF / BERT embedding 相似度</td></tr><tr><td><strong>AI轻识别层</strong></td><td>意图分类与重要度打分</td><td>仅对前两层通过的消息进行轻量AI识别，提取任务实体、时间、行为</td><td>MiniLLM / Embedding API</td></tr><tr><td><strong>增强层（Enrichment）</strong></td><td>信息补全</td><td>若消息关联了文件、链接或图片，则生成<code>linkedFiles</code>和<code>ai_tags</code>结构，形成AI输入前的标准化增强消息</td><td>Python预处理脚本 + AI打标</td></tr></tbody></table><p><strong>触发条件</strong>： 当增强消息通过第三层识别且满足触发条件（如高重要度或累计阈值）后，系统会执行以下动作：</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>该消息插入 MessageQueue（消息缓冲队列）</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>若消息数、重要度总和、时间窗口等达到设定条件</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>将队列内容批量提交给AI模型</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>生成结构化任务数据</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>输出 Markdown 汇总文档</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>清空队列并启动冷却计时</span></span></code></pre></div><hr><h3 id="批量调用与冷却机制" tabindex="-1"><strong>批量调用与冷却机制</strong> <a class="header-anchor" href="#批量调用与冷却机制" aria-label="Permalink to &quot;**批量调用与冷却机制**&quot;">​</a></h3><p>为防止高频触发，系统在触发策略中设计了以下三项核心机制：</p><h4 id="_1-批量检测机制" tabindex="-1">① 批量检测机制 <a class="header-anchor" href="#_1-批量检测机制" aria-label="Permalink to &quot;① 批量检测机制&quot;">​</a></h4><ul><li>系统维护一个<strong>消息缓冲队列（MessageQueue）</strong>；</li><li>每当有 <strong>增强消息</strong> 进入时，系统判断当前队列大小</li><li>若队列达到设定阈值（如20条或特定关键词超过阈值），则触发AI进行一次集中分析。</li></ul><h4 id="_2-冷却时间机制" tabindex="-1">② 冷却时间机制 <a class="header-anchor" href="#_2-冷却时间机制" aria-label="Permalink to &quot;② 冷却时间机制&quot;">​</a></h4><ul><li>每次AI调用后，系统进入冷却期（如30分钟或1小时）；</li><li>冷却期间的消息继续入库与初筛，但不触发AI；</li><li>冷却期结束后，若累计消息仍超出阈值，则再次触发AI汇总。</li></ul><h4 id="_3-异常触发机制" tabindex="-1">③ 异常触发机制 <a class="header-anchor" href="#_3-异常触发机制" aria-label="Permalink to &quot;③ 异常触发机制&quot;">​</a></h4><ul><li>若检测到明确的<strong>关键紧急任务</strong>（如含“立即”“今晚前”“紧急提交”），跳过冷却与批量限制；</li><li>立即触发AI分析与通知推送；</li><li><code>输出临时提醒文档</code>或<code>推送通知</code>。</li></ul><hr><h3 id="调度伪代码" tabindex="-1">调度伪代码 <a class="header-anchor" href="#调度伪代码" aria-label="Permalink to &quot;调度伪代码&quot;">​</a></h3><p>以下伪代码展示智能触发的整体调度逻辑（简化示意）：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># THRESHOLD: 消息重要度阈值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MAX_QUEUE_SIZE: 队列触发AI的最大消息数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># COOLDOWN_LIMIT: 冷却时间限制</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># COOLDOWN_TIME: 触发后冷却时间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 消息到达事件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on_new_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    save_to_raw_mongo(msg)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        upload_to_oss(msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #规则过滤与关联</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rule_filter(msg): </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    linked_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> associate_message_file(msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #热词检测</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hotword_filter(linked_msg):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #AI轻识别</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    importance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ai_light_check(linked_msg)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> importance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> THRESHOLD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 增强消息队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    enriched </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> enrich_message(linked_msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message_queue.append(enriched)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 判断触发条件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message_queue) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MAX_QUEUE_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       total_importance(message_queue) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IMPORTANCE_LIMIT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       time_since_last_trigger() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COOLDOWN_LIMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        trigger_ai_summary(message_queue)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        message_queue.clear()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        set_cooldown_timer(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COOLDOWN_TIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><hr><h3 id="性能评估" tabindex="-1">性能评估 <a class="header-anchor" href="#性能评估" aria-label="Permalink to &quot;性能评估&quot;">​</a></h3><table tabindex="0"><thead><tr><th>维度</th><th>原逻辑</th><th>现逻辑（增强消息 + 智能触发）</th><th>效果</th></tr></thead><tbody><tr><td>AI调用频率</td><td>高（单条触发）</td><td>低（批量触发）</td><td>节省计算资源</td></tr><tr><td>响应延迟</td><td>中等</td><td>低</td><td>实时性增强</td></tr><tr><td>数据利用率</td><td>低（仅文本）</td><td>高（文本 + 文件 + AI标签）</td><td>信息完整性提升</td></tr><tr><td>开发扩展性</td><td>低</td><td>高（独立关联与AI层）</td><td>可独立优化任意层</td></tr><tr><td>成本</td><td>高</td><td>中</td><td>显著节省 API Key 成本</td></tr></tbody></table><p><strong>总结：</strong> 该策略在测试环境中实现了“高召回、低频调用”的目标，既减少了AI负载，也保证了群聊关键信息的即时捕获。后续可结合消息类型（文本、图片、文件）继续细化规则层与热词模型，实现更智能的动态调整。</p>`,71)])])}const c=i(e,[["render",d]]);export{E as __pageData,c as default};
